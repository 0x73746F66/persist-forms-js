/**
 * @class persistJS
 * @verson 1.0
 * @author Christopher D Langton <chris@codewiz.biz>
 * @classDescription Automatically Persist Forms across page refreshes
 * @compatibility:
 * 		IE 8+
 * 		Firefox 21+
 * 		Chrome 27+
 * 		Safari 5.1+
 * 		Opera 15+
 * 		iOS Safari 4.0+
 * 		Android Browser 2.1+
 * 		Chrome for Android 28+
 * 		Firefox for Android 23+
 * 		Blackberry Browser 7.0+
*/
(function(e,t){if("sessionStorage"in e&&"querySelectorAll"in document&&"JSON"in e){var n=function(){if(e===this){return new n}this.isNodeOfType=function(e,t){return e.nodeName.toLowerCase()===t.toLowerCase()?true:false};this.getAncestorOfType=function(e,t){if(this.isNodeOfType(e.parentNode,t))return e.parentNode;else return this.getAncestorOfType(e.parentNode,t)};this.isNode=function(e){return typeof Node==="object"?e instanceof Node:e&&typeof e==="object"&&typeof e.nodeType==="number"&&typeof e.nodeName==="string"};this.isElement=function(e){return typeof HTMLElement==="object"?e instanceof HTMLElement:e&&typeof e==="object"&&e!==null&&e.nodeType===1&&typeof e.nodeName==="string"};if(this.isElement(this)||this.isNode(this)){var t=this.getAncestorOfType(this,"form");n().dbSave(t.id,this.name,this.value)}return this};n.fn=n.prototype={dbSave:function(t,n,r){this.validJsonString=function(e){try{JSON.parse(e)}catch(t){return false}return true};var i="";var s={};var o=e.sessionStorage;if(o.getItem(t)){i=o.getItem(t);if(this.validJsonString(i))s=JSON.parse(i)}s[n]=r;o.setItem(t,JSON.stringify(s));return this},updateDomFromDb:function(t,n){this.validJsonString=function(e){try{JSON.parse(e)}catch(t){return false}return true};var r="";var i={};var s=e.sessionStorage;if(s.getItem(t)){r=s.getItem(t);if(this.validJsonString(r))i=JSON.parse(r);var o=document.querySelectorAll("form#"+t+' [name="'+n+'"]');if(typeof i[n]!=="undefined")if(o.length>1){var u;for(var a=0;a<o.length;a++){u=o[a];if(u.value===i[n])u.checked=true}}else{if(o[0].name==="textarea")o[0].text=i[n];else o[0].value=i[n]}}return this},serialize:function(t){if(typeof t==="undefined")t="form[persist]";var n=document.querySelectorAll(t);var r=e.sessionStorage;var i=[];var s;var o="";var u;var a="";for(var f=0;f<n.length;f++){s=n[f];o=s.id;i[o]={};for(var l=0;l<s.length;l++){u=s[l];a=u.nodeName.toLowerCase();if(a==="input"||a==="select"||a==="textarea"){if(u.name.length>0){if(u.type==="radio"||u.type==="checkbox"){if(u.checked)i[o][u.name]=u.value}else if(u.name==="select"){i[o][u.name]=u.value}else if(u.name==="textarea"){if(u.length>0)i[o][u.name]=u.text}else{if(u.length>0)i[o][u.name]=u.value}}}}}return i},init:function(){var t=document.querySelectorAll("form[persist] *");var r="";for(var i=0;i<t.length;i++){r=t[i].nodeName.toLowerCase();if((r==="input"||r==="select"||r==="textarea")&&t[i].name.length>0)t[i].onchange=n}var s=e.sessionStorage;var o=document.querySelectorAll("form[persist]");var u;var a="";var f;for(var l=0;l<o.length;l++){u=o[l];if(u.id.length>0){a=u.id;console.log(a);if(s.getItem(a))for(var c=0;c<u.length;c++){f=u[c];r=f.nodeName.toLowerCase();if((r==="input"||r==="select"||r==="textarea")&&f.name.length>0)this.updateDomFromDb(a,f.name)}else{var h=this.serialize("form[persist]#"+a);s.setItem(a,JSON.stringify(h[a]))}}}return this}};e.persist=n;n().init()}})(window);